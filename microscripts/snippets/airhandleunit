# AirHandleUnit
# admin, last change: 2025-03-24 13:45:17

Sub AHUAutoMan
  echo console on
  dump event

  $BTN_Name = "BTN_ClimateONOff"
  $BTN_Attribut = "BUTTON"
  $INST = 1

  append $BTN_Climate=$BTN_Name + ":" + $INST + ":" + $BTN_Attribut

  gosub GetGuiElementValue/function $BTN_Name 1 return $auto
  gosub GetGuiElementValue/function $BTN_Name 2 return $man

  console "Read Config GUI Element - Auto Attribut " $auto
  console "Read Config GUI Element - Manual Attribut " $man

  read gui $ClimateONOff $BTN_Climate

  if $ClimateONOff = $auto
    gosub SetAuto 1
  elseif $ClimateONOff = $man then
    gosub SetMan 1
  else
    console "Fehler in der Config"
  endif  
endsub

Sub SetMan $Zone
  App.smartdirector.climate_config[{$Zone}].manual_override = Enabled
  gosub GUItoValve $Zone
endSub

Sub SetAuto $Zone
  App.smartdirector.climate_config[{$Zone}].manual_override = Disable
endSub

sub GUItoValve $Zone
  read gui $ValvePerc "SLD_CoolingValve:1:SLIDER"
  App.smartdirector.climate_config[{$Zone}].manual_cooling_value = {$ValvePerc}

  read gui $ValvePerc "SLD_HeaterValve:1:SLIDER"
  App.smartdirector.climate_config[{$Zone}].manual_heating_value = {$ValvePerc}
endsub

sub adjustPID $Zone
  read gui $pconst "SLD_Controller_P:1:SLIDER"
  read gui $iconst "SLD_Controller_I:1:SLIDER"
  read gui $dconst "SLD_Controller_D:1:SLIDER"

  tofloat $pconst
  tofloat $iconst
  tofloat $dconst

  $pconst=$pconst / 10
  $iconst=$iconst / 10
  $dconst=$dconst / 10

  tostring $pconst
  tostring $iconst
  tostring $dconst

  append $pid_constants=$pconst + " : " + $iconst + " : " + $dconst

  App.smartdirector.climate_config[{$Zone}].pid_constants = {$pid_constants}
endsub